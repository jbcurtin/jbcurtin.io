<!DOCTYPE HTML>
<html>
  
<head>
  <!-- Encoding -->
  <meta charset="UTF-8">
  <link rel="icon" href="/favicon.ico">
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Joseph Curtin - Mindful communication & software engineering" />
  <meta name="keywords" content="Machine Learning, Infrastructure, & Cloud" />
  <meta name="author" content="Joseph Curtin's Website" />
  <title>
    `serde`
    </title>
  <!-- Imports -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css"
    integrity="sha256-nQ6wLtrBdTlYGKygEWcUZItTqIGXhUmg2m34X4ZPXaQ="
    crossorigin="anonymous"/>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer" />
  <!-- <link rel="stylesheet" href="/main.css" crossorigin="anonymous" /> -->
  <link rel="stylesheet" href="https://jbcurtin.io/main.css">
  <script type="text/javascript" src="https://jbcurtin.io/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

  <body>
    <section class="columns">
      <div class="column is-3">
        
<div class="has-text-right page-title-column">
  <a href="/">
    <h1 class="page-title title is-2 has-text-primary"> Joseph Curtin </h1>
    <p class="page-subtitle subtitle is-6 vert-spacing"> Mindful communication & software engineering </p>
  </a>
  <!-- <hr class="title-divider" /> -->
  <section class="vert-spacing">
    <div class="equal-height">
      <div class="card-content is-flex" style="justify-content: center;">
        <figure class="image is-64x64 is-center">
          <img src="/images/profile.svg" alt="Brain" />
        </figure>
      </div>
    </div>
  </section>
  <section class="section" style="padding: 0;">
    <ul class="buttons">
      <li>
  <div id="subscribe-field" class="field has-addons">
    <div class="control has-icons-left has-icons-right">
      <input class="input" name="subscribe-email" type="email" placeholder="your@email.here to subscribe" />
      <span class="icon is-small is-left has-site-colors">
        <i class="fa-regular fa-newspaper"></i>
      </span>
      <span class="icon is-small is-right has-site-colors">
        <i class="fas fa-check"></i>
      </span>
    </div>
    <div id="subscribe-button" class="control">
      <button class="button has-site-colors">
        Subscribe
      </button>
    </div>
    <p class="note help is-danger" style="text-align: left;"> Invalid Email </p>
  </div>
</li>

      <li>
        <a href="mailto:webmain@jbcurtin.io" target="_blank" class="button">
          <span class="has-site-colors"> Connect over Email </span>
          <span class="icon is-medium has-site-colors">
            <i class="fa-regular fa-envelope"></i>
          </span>
        </a>
      </li>
      <li>
        <a href="/ja&#x2F;articles&#x2F;serde&#x2F;" class="button">
        <span class="has-site-colors">
            English&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <i class="fa-solid fa-language"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            日本語
          </span>
        </a>
      </li>
    </ul>
  </section>
</div>

        <div class="container">
          <aside class="menu hide-on-mobile">
            
<p class="menu-label">Search</p>
<ul class="menu-list">
  <li>
    <div class="field">
      <div class="control has-icons-left has-icons-right">
        <input id="aside-search-input" class="input" type="text" placeholder="Search Articles" value="">
        <span class="icon is-small is-left">
          <i class="fa-solid fa-magnifying-glass"></i>
        </span>
        <span class="icon is-small is-right">
          <i class="fas fa-close"></i>
        </span>
      </div>
    </div>
  </li>
</ul>

            
<p class="menu-label">Article Filters</p>
<ul class="menu-list">


  <li>
    <a href="&#x2F;articles&#x2F;">Performance Analysis</a>
  </li>

</ul>

          </aside>
        </div>
      </div>
      <div class="column is-9">
        <article class="content">
          <header class="main-top">
            <h1 class="page-title title is-2 has-text-primary"> `serde` </h1>
            <p class="subtitle is-6">
              <time datetime="2025-10-31"> October 31, 2025 </time>
            </p>
          </header>
          <section class="content">
            <p>
              <p>Implementing <code>Deserialize&lt;'de&gt;</code> on a struct always makes me take a step back. I start to question the validity of having to write a <code>Visitor&lt;'de&gt;</code>-trait compatible struct. Then I slowly remember that JSON can be a nested tree of pretty much any kind of data-object representation and I remember the brilliance of the with <code>serde</code>'s API approach all over again.</p>
<p>It's a good set of feels.</p>
<p>That being said, the documentation always takes a moment for me to remember what to do. Therefore I came up with these snippets to help me remember what I need to do, quicker than it would take for me to wait for ChatGPT to finish its generation phase</p>
<h2 id="renaming-a-property-on-the-object">Renaming a property on the Object</h2>
<p>Rust likes to use <code>snake_case</code> pretty much everywhere a variable, method, or function is written. Having the ability to rename the json object properties to something more Rust-like-able, allows to skip having the <code>#[allow(dead_code)]</code> macro</p>
<pre data-lang="rust" style="background-color:#191919;color:#f8f8f2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#ff5e5e;">use </span><span>serde::Deserialize;
</span><span>
</span><span>#[</span><span style="color:#e9fdac;">derive</span><span>(Debug, Deserialize)]
</span><span style="color:#ff5e5e;">pub </span><span style="font-style:italic;color:#fbdfb5;">struct </span><span>Content {
</span><span>	#[</span><span style="color:#e9fdac;">serde</span><span>(rename</span><span style="color:#ff5e5e;">=</span><span style="color:#ffffff;">&quot;</span><span style="color:#fbe3bf;">Name</span><span style="color:#ffffff;">&quot;</span><span>)]
</span><span>	</span><span style="color:#e9fdac;">name</span><span>: String,
</span><span>}
</span><span>#[</span><span style="color:#e9fdac;">tokio</span><span>::</span><span style="color:#e9fdac;">main</span><span>]
</span><span>async </span><span style="font-style:italic;color:#fbdfb5;">fn </span><span style="color:#8cdaff;">main</span><span>() {
</span><span>	</span><span style="font-style:italic;color:#fbdfb5;">let</span><span> content </span><span style="color:#ff5e5e;">= </span><span style="font-style:italic;color:#fbdfb5;">r</span><span style="color:#ffffff;">#&quot;</span><span style="color:#fbe3bf;">{&quot;Name&quot;: &quot;my name is, serde&quot;}</span><span style="color:#ffffff;">&quot;#</span><span>;
</span><span>	</span><span style="font-style:italic;color:#fbdfb5;">let</span><span> content: Content </span><span style="color:#ff5e5e;">= </span><span>serde_json::from_str(content).</span><span style="color:#6699cc;">unwrap</span><span>();
</span><span>	println!(</span><span style="color:#ffffff;">&quot;</span><span style="color:#fdb082;">{:?}</span><span style="color:#ffffff;">&quot;</span><span>, content.name);
</span><span>}
</span></code></pre>
<p>In <code>Content</code>, <code>name</code> is renamed from <code>Name</code> using <code>#[serde(rename="Name")</code>.</p>
<h2 id="deserializing-a-digit-into-an-enum">Deserializing a digit into an enum</h2>
<p>Sometimes <code>#[derive(Deserialize)]</code> isn't enough and we need to drop down into writing a trait implementation. Enums are straight forward using <code>TryFrom</code>. It can be used to map an error into something <code>Deserialize&lt;'de&gt;</code> will understand.</p>
<p>For example, if trying to keep a log of people logging into and out of an application. Tracking that information in a <code>struct Action{event:String}</code> is one way to do it. I personally would prefer to use a <a rel="noopener" target="_blank" href="https://doc.rust-lang.org/book/ch06-01-defining-an-enum.html">Rust enum</a>. The problem though is <code>serde</code> doesn't provide a macro to support enums the way I like to implement. ( At least from what I'm aware of ).</p>
<pre data-lang="rust" style="background-color:#191919;color:#f8f8f2;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#e9fdac;">derive</span><span>(Debug)]
</span><span style="color:#ff5e5e;">pub </span><span style="font-style:italic;color:#fbdfb5;">enum </span><span>AuditLogAction { 
</span><span>  LoggedIn,
</span><span>  LoggedOut,
</span><span>}
</span></code></pre>
<p>Implement the <code>TryFrom</code>  trait on the enum.</p>
<pre data-lang="rust" style="background-color:#191919;color:#f8f8f2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#fbdfb5;">impl </span><span>TryFrom&lt;</span><span style="font-style:italic;color:#fbdfb5;">i32</span><span>&gt; </span><span style="color:#ff5e5e;">for </span><span>AuditLogAction {
</span><span>  </span><span style="font-style:italic;color:#fbdfb5;">type </span><span>Error </span><span style="color:#ff5e5e;">=</span><span> AuditEndpointError;
</span><span>  </span><span style="font-style:italic;color:#fbdfb5;">fn </span><span style="color:#8cdaff;">try_from</span><span>(</span><span style="font-style:italic;color:#fc9354;">value</span><span>: </span><span style="font-style:italic;color:#fbdfb5;">i32</span><span>) -&gt; </span><span style="color:#fbe3bf;">Result</span><span>&lt;</span><span style="font-style:italic;color:#fbdfb5;">Self</span><span>, </span><span style="font-style:italic;color:#fbdfb5;">Self::</span><span>Error&gt; {
</span><span>    </span><span style="color:#fbe3bf;">Ok</span><span>(</span><span style="color:#ff5e5e;">match</span><span> value {
</span><span>      </span><span style="color:#fdb082;">0 </span><span style="color:#ff5e5e;">=&gt; </span><span style="font-style:italic;color:#fbdfb5;">Self</span><span>::LoggedIn,
</span><span>      </span><span style="color:#fdb082;">1 </span><span style="color:#ff5e5e;">=&gt; </span><span style="font-style:italic;color:#fbdfb5;">Self</span><span>::LoggedOut,
</span><span>      </span><span style="color:#ff5e5e;">_ =&gt; return </span><span style="color:#fbe3bf;">Err</span><span>(AuditEndpointError::AuditLogActionNotSupported(value))
</span><span>    })
</span><span>  }
</span><span>}
</span></code></pre>
<p>Finally, implement the deserialize trait which calls the <code>TryFrom</code> trait and maps the error to something <code>Deserialize&lt;'de&gt;</code> can understand.</p>
<pre data-lang="rust" style="background-color:#191919;color:#f8f8f2;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="font-style:italic;color:#fbdfb5;">impl</span><span>&lt;</span><span style="color:#ff5e5e;">&#39;de</span><span>&gt; Deserialize&lt;</span><span style="color:#ff5e5e;">&#39;de</span><span>&gt; </span><span style="color:#ff5e5e;">for </span><span>AuditLogAction {
</span><span>  </span><span style="font-style:italic;color:#fbdfb5;">fn </span><span style="color:#8cdaff;">deserialize</span><span>&lt;D&gt;(</span><span style="font-style:italic;color:#fc9354;">deserializer</span><span>: D) -&gt; </span><span style="color:#fbe3bf;">Result</span><span>&lt;</span><span style="font-style:italic;color:#fbdfb5;">Self</span><span>, </span><span style="font-style:italic;color:#fbdfb5;">D::</span><span>Error&gt;
</span><span>  </span><span style="color:#ff5e5e;">where</span><span> D: serde::Deserializer&lt;</span><span style="color:#ff5e5e;">&#39;de</span><span>&gt; {
</span><span>    </span><span style="font-style:italic;color:#fbdfb5;">let</span><span> value </span><span style="color:#ff5e5e;">= </span><span style="font-style:italic;color:#fbdfb5;">i32</span><span>::deserialize(deserializer)</span><span style="color:#ff5e5e;">?</span><span>;
</span><span>    AuditLogAction::try_from(value).</span><span style="color:#6699cc;">map_err</span><span>(serde::de::Error::custom)
</span><span>  }
</span><span>}
</span></code></pre>
<p>With everything setup, time to implement the main function that'll run the program and convert an array of integers from JSON into enum variants.</p>
<pre data-lang="rust" style="background-color:#191919;color:#f8f8f2;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#e9fdac;">tokio</span><span>::</span><span style="color:#e9fdac;">main</span><span>]
</span><span>async </span><span style="font-style:italic;color:#fbdfb5;">fn </span><span style="color:#8cdaff;">main</span><span>() {
</span><span>  </span><span style="font-style:italic;color:#fbdfb5;">let</span><span> content </span><span style="color:#ff5e5e;">= </span><span style="font-style:italic;color:#fbdfb5;">r</span><span style="color:#ffffff;">#&quot;</span><span style="color:#fbe3bf;">[0, 1]</span><span style="color:#ffffff;">&quot;#</span><span>;
</span><span>  </span><span style="font-style:italic;color:#fbdfb5;">let</span><span> content: </span><span style="color:#fbe3bf;">Vec</span><span>&lt;AuditLogAction&gt; </span><span style="color:#ff5e5e;">= </span><span>serde_json::from_str(content).</span><span style="color:#6699cc;">unwrap</span><span>();
</span><span>  println!(</span><span style="color:#ffffff;">&quot;</span><span style="color:#fdb082;">{content:?}</span><span style="color:#ffffff;">&quot;</span><span>);
</span><span>}
</span></code></pre>
<p>I'm still looking for a reason to use the <code>Visitor&lt;'de&gt;</code> pattern. <a rel="noopener" target="_blank" href="https://bsky.app/profile/ender-yoga.bsky.social">Any suggestions?</a></p>
<p>Full source code can be <a rel="noopener" target="_blank" href="https://github.com/jbcurtin/serde-nibs/tree/main">found here</a></p>

            </p>
          </section>
        </article>
        <div class="column is-12 show-on-mobile">
          <aside class="menu">
            
<p class="menu-label">Search</p>
<ul class="menu-list">
  <li>
    <div class="field">
      <div class="control has-icons-left has-icons-right">
        <input id="aside-search-input" class="input" type="text" placeholder="Search Articles" value="">
        <span class="icon is-small is-left">
          <i class="fa-solid fa-magnifying-glass"></i>
        </span>
        <span class="icon is-small is-right">
          <i class="fas fa-close"></i>
        </span>
      </div>
    </div>
  </li>
</ul>

            
<p class="menu-label">Article Filters</p>
<ul class="menu-list">


  <li>
    <a href="&#x2F;articles&#x2F;">Performance Analysis</a>
  </li>

</ul>

          </aside>
        </div>
      </div>
    </section>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VZP9H4GE0Y"></script>
<script type="text/javascript" src="https://jbcurtin.io/elasticlunr.min.js" defer></script>
<script type="text/javascript" src="https://jbcurtin.io/search_index.en.js" defer></script>
<script type="text/javascript" src="https://jbcurtin.io/js.cookie-3.0.5.min.js" integrity="sha256-WCzAhd2P6gRJF9Hv3oOOd+hFJi/QJbv+Azn4CGB8gfY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://jbcurtin.io/MathJax-3.2.2.js" defer></script>
<script type="text/javascript" src="https://jbcurtin.io/chart/tree_map.js" defer></script>
<script type="text/javascript" src="https://jbcurtin.io/main.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js" integrity="sha256-6EJwvQzVvfYP78JtAMKjkcsugfTSanqe4WGFpUdzo88=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js" integrity="sha256-OMcKHnypGrQOLZ5uYBKYUacX7Rx9Ssu91Bv5UDeRz2g=" crossorigin="anonymous"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script>
<script>
  function genIden(length) {
    var result           = '';
    var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    var charactersLength = characters.length;
    for ( var i = 0; i < length; i++ ) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
  }
  let gauid = Cookies.get('gauid');
  if (gauid == undefined) {
    gauid = genIden(8);
    Cookies.set('gauid', gauid);
  }
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-VZP9H4GE0Y', {
    user_id: gauid
  });
</script>

    <script type="text/javascript">
/// Debounce
function debounce(func, wait) {
  var timeout;
  return function () {
    var context = this;
    var args = arguments;
    clearTimeout(timeout);
    timeout = setTimeout(function () {
      timeout = null;
      func.apply(context, args);
    }, wait);
  };
}
function initAsideSearch() {
  const $aside_search_input = document.getElementById('aside-search-input');
  if($aside_search_input === null) {
    return;
  }
  $aside_search_input.addEventListener("keyup", debounce(async function($event) {
    if ($event.keyCode === 13 || $event.keyCode === 32) {
      var term = $aside_search_input.value.trim();
      if ($event.keyCode === 32) {
        term = term + " ";
      }
      const url_parts = [window.location.protocol, '//', window.location.host];
      if ("en" != "en") {
        url_parts.push('/en');
      }
      url_parts.push('/search/')
      const search_url = new URL(url_parts.join(''));
      search_url.searchParams.set('q', term);
      window.location.href = search_url;
    }
  }, 150));
}
if (document.readyState === "complete" || (document.readyState !== "loading" && !document.documentElement.doScroll)) {
  initAsideSearch();
} else {
  document.addEventListener("DOMContentLoaded", initAsideSearch);
} 
</script>

    <script type="text/javascript">
  $.fn.SubscribeField = function() {
    const COOKIE_NAME = 'subscribe-email';
    const elm = $(this);
    const regBttnElm = $("#subscribe-button");
    const noteElm = elm.find(".note");
    noteElm.hide();
    const setInvalid = function() {
      const newspaper_container = elm.find('.fa-newspaper').parent();
      newspaper_container.addClass('has-text-danger');
      // Right Icon
      const right_icon_container = elm.find('.icon.is-right');
      right_icon_container.addClass('has-text-danger');
      const right_icon = right_icon_container.find('i.fa-check');
      right_icon.removeClass('fa-check');
      right_icon.addClass('fa-close');
    }
    const setValid = function() {
      const newspaper_container = elm.find('.fa-newspaper').parent();
      newspaper_container.removeClass('has-text-danger');
      // Right Icon
      const right_icon_container = elm.find('.icon.is-right');
      right_icon_container.removeClass('has-text-danger');
      const right_icon = right_icon_container.find('i.fa-close');
      right_icon.removeClass('fa-close');
      right_icon.addClass('fa-check');
    }
    const setConfirmState = function(email) {
      const msg = `is been subscribed`;
      regBttnElm.find('button').text('Subscribed');
      regBttnElm.find('button').attr('disabled', 'disabled');
      elm.find('input[name=subscribe-email]').attr('disabled', 'disabled');
      elm.find('input[name=subscribe-email]').val(email);
      elm.find('.fa-newspaper').addClass('has-text-info');
      elm.find('.fa-check').parent().hide();
      // elm.find('.fa-check').parent().html('<span> Saved </span>');
      Cookies.set(COOKIE_NAME, email, { expires: 365, domain: window.location.hostname, SameSite: 'Strict', Secure: true });
    }
    const validateEmail = (email) => {
      return email.match(
        /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
      );
    }
    const handleKeyEvent = function($event) {
      const email = elm.find('input[name=subscribe-email]').val();
      if (validateEmail(email) == null) {
        setInvalid();
      } else {
        setValid();
        if ($event.originalEvent.keyCode == 13) {
          submitEmail();
        }
      }
    }
    // Handle Submission to Backend - ajax
    const submitEmail = function() {
      const email = elm.find('input[name=subscribe-email]').val();
      if (validateEmail(email) == null) {
        setInvalid();
        return;
      }
      const buildUrl = function (path) {
        if (window.location.hostname == 'localhost') {
          return `http://localhost:8200${path}`;
        } else if (window.location.hostname == 'jbcurtin.io') {
          return `https://newsletter.mlops-and-cloud-db.com${path}`;
        } else {
          console.error("Unable to build path");
        }
      }
      const handleSubmission = function(data) {
        setConfirmState(email);
      }
      const handleSubmissionError = function($event) {
        if ($event.responseText == "Success") {
          handleSubmission($event);
          return;
        }
        setInvalid();
      }
      $.ajax({
        type: 'POST',
        url: buildUrl('/nl/register'),
        data: `{ "email": "${email}" }`,
        success: handleSubmission,
        error: handleSubmissionError,
        contentType: "application/json",
        dataType: "json"
      });
    }
    // Attach Events
    setValid();
    // Detect Cookies
    if (Cookies.get(COOKIE_NAME) != undefined) {
      const email = Cookies.get(COOKIE_NAME);
      setConfirmState(email);
    } else {
      elm.find('input[name=subscribe-email]').on('keyup', handleKeyEvent);
      regBttnElm.on('click', function($event) {
        submitEmail();
        $event.preventDefault();
      });
    }
  }
  $(document).ready(() => {
    console.log('activate')
    $("#subscribe-field").SubscribeField();
  })
</script>

    <script type="text/javascript">
      gtag('set', 'content_group', '/articles');
      gtag('event', 'select_content', {
        'content_type': 'article',
        'content_id': '/articles/serde/'
      });
    </script>
  </body>
</html>